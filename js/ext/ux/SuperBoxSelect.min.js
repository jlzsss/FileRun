Ext.namespace("Ext.ux.form"),Ext.ux.form.SuperBoxSelect=function(t){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,t),this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear","autoSize","addItemBox","save")},Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{mode:"local",caseSensitive:!0,allowAddNewData:!0,backspaceDeletesLastItem:!0,classField:null,clearBtnCls:"",displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",editBtnCls:"",lockBtnCls:"",fixFocusOnTabSelect:!0,forceFormValue:!0,itemDelimiterKey:[Ext.EventObject.ENTER,Ext.EventObject.TAB],pinList:!0,preventDuplicates:!0,queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:!0,renderFieldBtns:!1,locked:!1,allowUnlock:!0,stackItems:!1,styleField:null,supressClearValueRemoveEvents:!1,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(!1),usedRecords:new Ext.util.MixedCollection(!1),addedRecords:[],remoteLookup:[],hideTrigger:!0,grow:!1,resizable:!1,multiSelectMode:!1,preRenderValue:null}),this.forceFormValue&&this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this}),Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this),"remote"===this.mode&&this.store&&this.store.on("load",this.onStoreLoad,this)},onRender:function(t,e){var s=this.hiddenName;this.hiddenName=null,Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,t,e),this.hiddenName=s,this.manageNameAttribute();s=!0===this.stackItems?"x-superboxselect-stacked":"";(this.renderFieldBtns||this.locked)&&(s+=" x-superboxselect-display-btns"),this.locked&&(s+=" x-superboxselect-locked"),this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field"),this.wrapEl=this.el.wrap({tag:"ul"}),this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+s}),this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"}),this.setupFieldButtons().manageClearBtn(),this.setupFormInterception()},onStoreLoad:function(t,e,s){var i=s.params[this.queryParam]||t.baseParams[this.queryParam]||"",t=s.params[this.queryValuesIndicator]||t.baseParams[this.queryValuesIndicator];this.removeValuesFromStore&&this.store.each(function(t){this.usedRecords.containsKey(t.get(this.valueField))&&this.store.remove(t)},this),t&&(t=i.split(this.queryValuesDelimiter),Ext.each(t,function(t){this.remoteLookup.remove(t);t=this.findRecord(this.valueField,t);t&&this.addRecord(t)},this),this.setOriginal&&(this.setOriginal=!1,this.originalValue=this.getValue())),""!==i&&this.allowAddNewData&&Ext.each(this.remoteLookup,function(t){"object"==typeof t&&t[this.displayField]==i&&(this.remoteLookup.remove(t),e.length&&e[0].get(this.displayField)===i?this.addRecord(e[0]):(t=this.createRecord(t),this.store.add(t),this.addRecord(t),this.addedRecords.push(t),function(){this.isExpanded()&&this.collapse()}.defer(10,this)))},this);var o,r=[];""===i?Ext.each(this.addedRecords,function(t){this.preventDuplicates&&this.usedRecords.containsKey(t.get(this.valueField))||r.push(t)},this):(o=new RegExp(Ext.escapeRe(i)+".*","i"),Ext.each(this.addedRecords,function(t){this.preventDuplicates&&this.usedRecords.containsKey(t.get(this.valueField))||o.test(t.get(this.displayField))&&r.push(t)},this)),this.store.add(r),this.store.sort(this.displayField,"ASC"),0===this.store.getCount()&&this.isExpanded()&&this.collapse()},setupFieldButtons:function(){return this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"}),this.renderFieldBtns&&(this.buttonClear=this.buttonWrap.createChild({tag:"li",cls:"fa fa-fw fa-times"+this.clearBtnCls}),this.buttonExpand=this.buttonWrap.createChild({tag:"li",cls:"fa fa-fw fa-angle-down "+this.expandBtnCls})),this.locked&&this.allowUnlock&&(this.buttonEdit=this.buttonWrap.createChild({tag:"li",cls:"x-superboxselect-btn-edit fa fa-fw fa-edit "+this.editBtnCls}),this.buttonLock=this.buttonWrap.createChild({tag:"li",cls:"x-superboxselect-btn-lock fa fa-fw fa-save "+this.lockBtnCls})),this.initButtonEvents(),this},initButtonEvents:function(){this.renderFieldBtns&&(this.buttonClear.on("click",function(t){t.stopEvent(),this.disabled||(this.clearValue(),this.el.focus())},this),this.buttonExpand.on("click",function(t){t.stopEvent(),this.disabled||(this.isExpanded()?this.multiSelectMode=!1:this.pinList&&(this.multiSelectMode=!0),this.onTriggerClick())},this)),this.locked&&this.allowUnlock&&(this.buttonEdit.on("click",function(t){t.stopEvent(),this.unlock(),this.el.focus()},this),this.buttonLock.on("click",function(t){t.stopEvent(),this.lock(!0)},this))},lock:function(t){if(t){t=this.getValue();if(t.toLowerCase()!=this.valuesBeforeUnlock)this.fireEvent("lockedWidthChanges",this,this.items);else if(0==t.length)return!1}this.outerWrapEl.addClass("x-superboxselect-locked"),this.locked=!0},unlock:function(){this.outerWrapEl.removeClass("x-superboxselect-locked"),this.locked=!1,this.valuesBeforeUnlock=this.getValue().toLowerCase()},removeButtonEvents:function(){return this.buttonClear.removeAllListeners(),this.buttonExpand.removeAllListeners(),this.buttonEdit.removeAllListeners(),this.buttonLock.removeAllListeners(),this},clearCurrentFocus:function(){return this.currentFocus&&(this.currentFocus.onLnkBlur(),this.currentFocus=null),this},initEvents:function(){var e=this.el;e.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});var s=this;Ext.isWebKit?e.dom.addEventListener("copy",function(t){t.clipboardData&&(t.preventDefault(),t.clipboardData.setData("text/plain",s.getValue()))}):Ext.isIE&&e.dom.addEventListener("beforecopy",function(t){window.clipboardData&&(t.returnValue=!1,window.clipboardData.setData("Text",s.getValue()))}),this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this}),this.wrapEl.on("click",this.onWrapClick,this),this.outerWrapEl.on("click",this.onWrapClick,this),this.inputEl.focus=function(){e.focus()},Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this),Ext.apply(this.keyNav,{tab:function(t){return this.fixFocusOnTabSelect&&this.isExpanded()?(t.stopEvent(),e.blur(),this.onViewClick(!1),this.focus(!1,10)):(this.onViewClick(!1),""!==e.dom.value&&this.setRawValue("")),!0},down:function(t){this.isExpanded()||this.currentFocus?(this.inKeyMode=!0,this.selectNext()):this.onTriggerClick()},enter:function(){}})},onClick:function(){this.clearCurrentFocus(),this.collapse(),this.autoSize()},beforeBlur:Ext.form.ComboBox.superclass.beforeBlur,onFocus:function(){this.outerWrapEl.addClass(this.focusClass),Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass),this.clearCurrentFocus(),""!==this.el.dom.value&&this.autoSize(),Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections(),this.multiSelectMode=!1},onWrapClick:function(t){t.stopEvent(),this.collapse(),this.el.focus(),this.clearCurrentFocus()},markInvalid:function(t){var e;if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.addClass(this.invalidClass),t=t||this.invalidText,this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:t,qclass:"x-form-invalid-tip"}),Ext.apply(this.wrapEl.dom,{qtip:t,qclass:"x-form-invalid-tip"}),Ext.QuickTips&&Ext.QuickTips.enable();break;case"title":this.el.dom.title=t,this.wrapEl.dom.title=t,this.outerWrapEl.dom.title=t;break;case"under":if(!this.errorEl){if(!(e=this.getErrorCt())){this.el.dom.title=t;break}this.errorEl=e.createChild({cls:"x-form-invalid-msg"}),this.errorEl.setWidth(e.getWidth(!0)-20)}this.errorEl.update(t),Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){if(!(e=this.getErrorCt())){this.el.dom.title=t;break}this.errorIcon=e.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon(),Ext.apply(this.errorIcon.dom,{qtip:t,qclass:"x-form-invalid-tip"}),this.errorIcon.show(),this.on("resize",this.alignErrorIcon,this);break;default:(e=Ext.getDom(this.msgTarget)).innerHTML=t,e.style.display=this.msgDisplay}this.fireEvent("invalid",this,t)}},clearInvalid:function(){if(this.rendered&&!this.preventMark){switch(this.outerWrapEl.removeClass(this.invalidClass),this.msgTarget){case"qtip":this.el.dom.qtip="",this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="",this.wrapEl.dom.title="",this.outerWrapEl.dom.title="";break;case"under":this.errorEl&&Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this);break;case"side":this.errorIcon&&(this.errorIcon.dom.qtip="",this.errorIcon.hide(),this.un("resize",this.alignErrorIcon,this));break;default:var t=Ext.getDom(this.msgTarget);t.innerHTML="",t.style.display="none"}this.fireEvent("valid",this)}},alignErrorIcon:function(){this.wrap&&this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])},expand:function(){!this.isExpanded()&&this.hasFocus&&(this.list.alignTo(this.outerWrapEl,this.listAlign).show(),this.innerList.setOverflow("auto"),Ext.getDoc().on({mousewheel:this.collapseIf,mousedown:this.collapseIf,scope:this}),this.fireEvent("expand",this))},restrictHeight:function(){var t=this.innerList.dom,e=t.scrollTop,s=this.list;t.style.height="";var i=s.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,o=Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight),r=this.getPosition()[1]-Ext.getBody().getScroll().top,n=Ext.lib.Dom.getViewHeight()-r-this.getSize().height,n=Math.max(r,n,this.minHeight||0)-i-5,o=Math.min(o,n,this.maxHeight);this.innerList.setHeight(o),s.beginUpdate(),s.setHeight(o+i),s.alignTo(this.outerWrapEl,this.listAlign),s.endUpdate(),this.multiSelectMode&&(t.scrollTop=e)},validateValue:function(t){return 0!==this.items.getCount()||this.allowBlank?(this.clearInvalid(),!0):(this.markInvalid(this.blankText),!1)},manageNameAttribute:function(){0===this.items.getCount()&&this.forceFormValue?this.el.dom.setAttribute("name",this.hiddenName||this.name):this.el.dom.removeAttribute("name")},setupFormInterception:function(){var i,o;this.findParentBy(function(t){t.getForm&&(i=t.getForm())}),i&&(o=i.getValues,i.getValues=function(t){this.el.dom.disabled=!0;var e=this.el.dom.value;this.setRawValue("");var s=o.call(i);return this.el.dom.disabled=!1,this.setRawValue(e),this.forceFormValue&&0===this.items.getCount()&&(s[this.name]=""),t?Ext.urlEncode(s):s}.createDelegate(this))},onResize:function(t,e,s,i){var o=0;this.wrapEl&&(this._width=t,this.outerWrapEl.setWidth(t-o),this.renderFieldBtns&&(o+=this.buttonWrap.getWidth()+20,this.wrapEl.setWidth(t-o))),Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,t,e,s,i),this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this),this.items.each(function(t){t.enable()}),this.renderFieldBtns&&this.initButtonEvents()},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this),this.items.each(function(t){t.disable()}),this.renderFieldBtns&&this.removeButtonEvents()},clearValue:function(t){return Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this),this.preventMultipleRemoveEvents=t||this.supressClearValueRemoveEvents||!1,this.removeAllItems(),this.preventMultipleRemoveEvents=!1,this.fireEvent("clear",this),this},onKeyUp:function(t){!1===this.editable||t.isSpecialKey()&&t.getKey()!==t.BACKSPACE||-1!==this.itemDelimiterKey.indexOf(t.getKey())||t.hasModifier()&&!t.shiftKey||(this.lastKey=t.getKey(),this.dqTask.delay(this.queryDelay))},onKeyDownHandler:function(t,e){var s,i,o;if((t.getKey()===t.DELETE||t.getKey()===t.SPACE)&&this.currentFocus)return t.stopEvent(),s=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),o=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),o<this.items.getCount()-1&&(i=this.items.itemAt(o+1)),s.preDestroy(!0),i&&function(){i.onLnkFocus(),this.currentFocus=i}.defer(200,this),!0;var r,n=this.el.dom.value,l=t.ctrlKey;if(-1!==this.itemDelimiterKey.indexOf(t.getKey())||","==t.browserEvent.key){if(t.stopEvent(),""!==n)l||!this.isExpanded()?(this.view.clearSelections(),this.collapse(),this.setRawValue(""),this.fireEvent("newitem",this,n),(l={id:Ext.id()})[this.valueField]=n,l[this.displayField]=Ext.util.Format.htmlEncode(n),this.addNewItem(l)):this.onViewClick();else{if(!this.isExpanded())return;this.onViewClick()}return!0}if(""===n)return t.getKey()===t.HOME?(t.stopEvent(),0<this.items.getCount()&&(this.collapse(),(r=this.items.get(0)).el.focus()),!0):t.getKey()===t.BACKSPACE?(t.stopEvent(),this.currentFocus?(s=this.currentFocus,this.on("expand",function(){this.collapse()},this,{single:!0}),o=this.items.indexOfKey(s.key),this.clearCurrentFocus(),o<this.items.getCount()-1&&(i=this.items.itemAt(o+1)),s.preDestroy(!0),void(i&&function(){i.onLnkFocus(),this.currentFocus=i}.defer(200,this))):((r=this.items.get(this.items.getCount()-1))&&(this.backspaceDeletesLastItem?(this.on("expand",function(){this.collapse()},this,{single:!0}),r.preDestroy(!0)):this.on("expand",function(){this.collapse(),this.currentFocus=r,this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:!0})),!0)):t.isNavKeyPress()?t.getKey()===t.LEFT||t.getKey()===t.UP&&!this.isExpanded()?(t.stopEvent(),this.collapse(),r=this.items.get(this.items.getCount()-1),this.currentFocus?(o=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),0!==o&&(this.currentFocus=this.items.itemAt(o-1),this.currentFocus.onLnkFocus())):(this.currentFocus=r)&&r.onLnkFocus(),!0):t.getKey()===t.DOWN&&this.currentFocus?(this.collapse(),t.stopEvent(),(o=this.items.indexOfKey(this.currentFocus.key))==this.items.getCount()-1?this.clearCurrentFocus.defer(10,this):(this.clearCurrentFocus(),this.currentFocus=this.items.itemAt(o+1),this.currentFocus&&this.currentFocus.onLnkFocus()),!0):void(t.getKey()===t.RIGHT&&(this.collapse(),r=this.items.itemAt(0),this.currentFocus?(o=this.items.indexOfKey(this.currentFocus.key),this.clearCurrentFocus(),o<this.items.getCount()-1&&(this.currentFocus=this.items.itemAt(o+1),this.currentFocus&&this.currentFocus.onLnkFocus())):(this.currentFocus=r)&&r.onLnkFocus())):(this.multiSelectMode=!1,void this.clearCurrentFocus());this.autoSize()},onKeyUpBuffered:function(t){t.isNavKeyPress()||this.autoSize()},reset:function(){this.killItems(),Ext.ux.form.SuperBoxSelect.superclass.reset.call(this),this.addedRecords=[],this.autoSize().setRawValue("")},removeAllItems:function(){return this.items.each(function(t){t.preDestroy(!0)},this),this.manageClearBtn(),this},killItems:function(){return this.items.each(function(t){t.kill()},this),this.resetStore(),this.items.clear(),this.manageClearBtn(),this},resetStore:function(){return this.store.clearFilter(),this.removeValuesFromStore&&(this.usedRecords.each(function(t){this.store.add(t)},this),this.usedRecords.clear(),this.sortStore()),this},sortStore:function(){var t=this.store.getSortState();return t&&t.field&&this.store.sort(t.field,t.direction),this},getCaption:function(t){"string"==typeof this.displayFieldTpl&&(this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl));var e,t=t instanceof Ext.data.Record?t.data:t;return this.displayFieldTpl?e=this.displayFieldTpl.apply(t):this.displayField&&(e=t[this.displayField]),e},addRecord:function(t){var e=t.data[this.displayField],s=this.getCaption(t),i=t.data[this.valueField],o=this.classField?t.data[this.classField]:"",r=this.styleField?t.data[this.styleField]:"";this.removeValuesFromStore&&(this.usedRecords.add(i,t),this.store.remove(t)),this.addItemBox(i,e,s,o,r),this.fireEvent("additem",this,i,t)},createRecord:function(t){var e;return this.recordConstructor||(e=[{name:this.valueField},{name:this.displayField}],this.classField&&e.push({name:this.classField}),this.styleField&&e.push({name:this.styleField}),this.recordConstructor=Ext.data.Record.create(e)),new this.recordConstructor(t)},addItems:function(t){Ext.isArray(t)?Ext.each(t,function(t){this.addItem(t)},this):this.addItem(t)},addNewItem:function(t){this.addItem(t,!0)},addItem:function(t,e){var s=t[this.valueField];if(this.disabled)return!1;if(!this.preventDuplicates||!this.hasValue(s)){var i=this.findRecord(this.valueField,s);if(i)this.addRecord(i);else if(this.allowAddNewData){if(!this.allowAddNewData&&"remote"===this.mode)return this.remoteLookup.push(t),void this.doQuery(s,!1,!1,e);t=this.createRecord(t);return this.store.add(t),this.addRecord(t),!0}}},addItemBox:function(t,e,s,i,o){var r=Ext.id(null,"sbx-item"),e=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+i,style:function(t){var e="";if("function"==typeof t)e=t.call();else if("object"==typeof t)for(var s in t)e+=s+":"+t[s]+";";else"string"==typeof t&&(e=t+";");return e}(this.extraItemStyle)+" "+o,caption:s,display:e,value:t,key:r,listeners:{remove:function(t){!1!==this.fireEvent("beforeremoveitem",this,t.value)&&(this.items.removeKey(t.key),this.removeValuesFromStore&&this.usedRecords.containsKey(t.value)&&(this.store.add(this.usedRecords.get(t.value)),this.usedRecords.removeKey(t.value),this.sortStore(),this.view&&this.view.render()),this.preventMultipleRemoveEvents||this.fireEvent.defer(250,this,["removeitem",this,t.value,this.findInStore(t.value)]))},destroy:function(){this.collapse(),this.autoSize().manageClearBtn().validateValue()},scope:this}});e.render(),t={tag:"input",type:"hidden",value:Ext.util.Format.htmlEncode(t),name:this.hiddenName||this.name},this.disabled&&Ext.apply(t,{disabled:"disabled"}),e.hidden=this.el.insertSibling(t,"before"),this.items.add(r,e),this.autoSize().manageClearBtn().validateValue(),this.fireEvent("addItemBox",this,e)},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered)return this;var t="x-superboxselect-btn-hide";return 0===this.items.getCount()?this.buttonClear.addClass(t):this.buttonClear.removeClass(t),this},findInStore:function(t){t=this.store.find(this.valueField,t);return-1<t&&this.store.getAt(t)},getValue:function(){var e=[];return this.items.each(function(t){e.push(t.value)}),e.join(this.valueDelimiter)},getValueEx:function(){var s=[];return this.items.each(function(t){var e={};e[this.valueField]=t.value,e[this.displayField]=t.display,this.classField&&(e[this.classField]=t.cls||""),this.styleField&&(e[this.styleField]=t.style||""),s.push(e)},this),s},initValue:function(){Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this),"remote"===this.mode&&(this.setOriginal=!0)},setValue:function(t){var e;this.rendered?(this.removeAllItems().resetStore(),this.remoteLookup=[],Ext.isEmpty(t)||(e=t,Ext.isArray(t)||(e=(t=""+t).split(this.valueDelimiter)),Ext.each(e,function(t){var e=this.findRecord(this.valueField,t);e?"remote"===this.mode&&this.remoteLookup.push(t):this.addRecord(e)},this),"remote"===this.mode&&(e=this.remoteLookup.join(this.queryValuesDelimiter),this.doQuery(e,!1,!0)))):this.value=t},setValueEx:function(t){this.removeAllItems().resetStore(),Ext.isArray(t)||(t=[t]),this.remoteLookup=[],this.allowAddNewData?Ext.each(t,function(t){t=this.findRecord(this.valueField,t[this.valueField])||this.createRecord(t);this.addRecord(t)},this):Ext.each(t,function(t){this.addItem(t)},this)},hasValue:function(e){var s=!1;return this.items.each(function(t){if(!this.caseSensitive&&t.value.toLowerCase()==e.toLowerCase()||this.caseSensitive&&t.value==e)return!(s=!0)},this),s},onSelect:function(t,e){!1!==this.fireEvent("beforeselect",this,t,e)&&(e=t.data[this.valueField],this.preventDuplicates&&this.hasValue(e)||(this.setRawValue(""),this.lastSelectionText="",!1!==this.fireEvent("beforeadditem",this,e)&&this.addRecord(t),0!==this.store.getCount()&&this.multiSelectMode?this.restrictHeight():this.collapse()))},onDestroy:function(){this.items.purgeListeners(),this.killItems(),this.renderFieldBtns&&Ext.destroy(this.buttonClear,this.buttonExpand,this.buttonWrap),Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl),Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered)return this;this.metrics||(this.metrics=Ext.util.TextMetrics.createInstance(this.el));var t=this.el.dom.value,e=document.createElement("div");""===t&&this.emptyText&&(t=this.emptyText),e.appendChild(document.createTextNode(t)),t=e.innerHTML,e=null;t=Math.max(this.metrics.getWidth(t)+24,24);return void 0!==this._width&&(t=Math.min(this._width,t)),this.el.setWidth(t),this.fireEvent("autoSize",this),this},doQuery:function(t,e,s,i){var o={query:t=Ext.isEmpty(t)?"":t,forceAll:e,combo:this,cancel:!1};if(!1===this.fireEvent("beforequery",o)||o.cancel)return!1;t=o.query,(!0===(e=o.forceAll)||t.length>=this.minChars||s&&!Ext.isEmpty(t))&&(this.lastQuery!==t||i?(this.lastQuery=t,"local"==this.mode?(this.selectedIndex=-1,e?this.store.clearFilter():this.store.filter(this.displayField,t),this.onLoad()):(this.store.baseParams[this.queryParam]=t,this.store.baseParams[this.queryValuesIndicator]=s,this.store.load({params:this.getParams(t)}),i||this.expand())):(this.selectedIndex=-1,this.onLoad()))}}),Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect),Ext.ux.form.SuperBoxSelectItem=function(t){Ext.apply(this,t),Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)},Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(t){var e=this.owner;if(e.locked)return e.fireEvent("lockedItemClick",e,this),!1;e.clearCurrentFocus().collapse(),e.el.dom.focus(),function(){this.onLnkFocus(),e.currentFocus=this}.defer(10,this)},onElDblClick:function(t){if(this.owner.locked)return!1;this.owner.itemDlbClick&&this.owner.itemDlbClick(this,t),this.preDestroy(),this.owner.el.dom.value=this.value,this.owner.el.focus(!0)},onLnkClick:function(t){t&&t.stopEvent(),this.preDestroy(),this.owner.el.focus()},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.dom&&(this.el.removeClass("x-superboxselect-item-focus"),this.owner.outerWrapEl.removeClass("x-form-focus"))},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:!0}),this.el.on("dblclick",this.onElDblClick,this,{stopEvent:!0})},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,scope:this})},enableAllListeners:function(){this.enableElListeners(),this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners(),this.lnk.un("click",this.onLnkClick,this)},onRender:function(t,e){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,t,e);e=this.el;e&&e.remove(),this.el=e=t.createChild({tag:"li",cls:"x-superboxselect-item",html:this.caption},t.last()),Ext.apply(e,{preDestroy:function(){this.preDestroy()}.createDelegate(this)}),this.enableElListeners(),this.lnk=e.createChild({tag:"span",cls:"x-superboxselect-item-close"}),this.disabled?this.disableAllListeners():this.enableLnkListeners(),this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this}),this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var t=this.owner.items.get(0).el.focus();t&&t.el.focus()},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]),this.keyMap.stopEvent=!0},moveFocus:function(t){t=this.el["left"==t?"prev":"next"]()||this.owner.el;t.focus.defer(100,t)},preDestroy:function(t){if(!1!==this.fireEvent("remove",this)){function e(){this.owner.navigateItemsWithTab&&this.moveFocus("right"),this.hidden.remove(),this.hidden=null,this.destroy()}return t?e.call(this):this.el.hide({duration:.2,callback:e,scope:this}),this}},kill:function(){this.hidden.remove(),this.hidden=null,this.purgeListeners(),this.destroy()},onDisable:function(){this.hidden&&this.hidden.dom.setAttribute("disabled","disabled"),this.keyMap.disable(),Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){this.hidden&&this.hidden.dom.removeAttribute("disabled"),this.keyMap.enable(),Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el),Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}}),Ext.reg("superbox",Ext.ux.form.SuperBoxSelect);